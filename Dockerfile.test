FROM networkml
LABEL maintainer="Charlie Lewis <clewis@iqt.org>"

# Needed for erlang dependencies
RUN echo "http://dl-cdn.alpinelinux.org/alpine/v3.11/community" >> /etc/apk/repositories

RUN apk add build-base cython gcc linux-headers --update --no-cache && \
    apk add rabbitmq-server --update --no-cache --repository http://dl-3.alpinelinux.org/alpine/edge/testing/ --allow-untrusted && \
    rm -rf /var/cache/apk && \
    pip3 install --no-cache-dir -r test-requirements.txt
ENTRYPOINT ["pytest"]
CMD ["-l", "-s", "-v", "-nauto", "--cov=tests/", "--cov=networkml/", "--cov-report", "term-missing", "-c", ".coveragerc", "--rabbitmq-port=5672"]
